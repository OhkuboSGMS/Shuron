# はじめに {#introduction}

## 背景

ゲーム市場は著しい発展を遂げ続けている.毎年、ゲームによる収益は増加し続けており,
リサーチ会社のNewZooの発表[@Game-market]によると,2019年現在,全世界で25億人のゲームプレイヤが存在し,
2022年の消費者支出は196億ドルに増加すると予測されている.

ゲームが人々を熱中させ続ける要因はゲームを遊ぶことの面白さにある.
ゲームの面白さについての理論にコスター理論[@Koster]とマロン理論[@Malone]という理論が存在する.
またゲームに限定されていないフロー理論[@Flow]も存在する.
これらの理論は「行為の挑戦の機会と行為者の技能の適合」がプレイヤがゲームを面白いと面白いと感じる要素の
一つであると共通して述べている.

この理論に従った場合、ゲームはプレイヤに対する習熟度沿ったコンテンツを提供する必要がある.

コンテンツとはグラフィックやサウンド要素など芸術的要素を除いた,
オブジェクトのレイアウトや敵の状態、強さなどゲームプレイの質に作用する物である.
これをレベルと呼び、レベルを構築することをレベルデザインと言う.
レベルデザインの質によってプレイヤのゲーム体験の質を変化させる.

ゲーム市場の広がりに比例してゲームの面白さのためのレベル需要は増え続けているが,
人間の手によるレベルデザインは高額[@the-cost-of-games]
で開発規模は拡大しない[@POGGI]
ことがわかっている.

ゲーム市場の需要に対して人間の手によるレベルの生成には限界があるため,
よって、ゲームレベルの自動生成機能を提供することが求められる.


## 目的

<!--- {
フランクにまとめ:
PCGとかが結構前のゲームレベル生成では使われていて
最近はGANを使って研究もされている.
けど、現段階だとゲームレベルの数が足りないから
それっぽく仕上げるために工夫している.
それよりもレベルがいっぱいある環境が準備できたらいいよね.

(前々手法：ゲームごとの人間の手による実装
前手法: GANを用いたジェネレータの学習からの潜在変数の事前知識を用いた志向学習
今回手法: 大量のデータを用いたステージからの学習 )

ここから
}
//TODO PCGは生成系の話であり全てPCGだがそれぞれのメソッドが違うことを書かなかればならない

 -->

ゲームレベルの自動生成の初期の手法はゲームごとの事前知識を用いて人間の手によるアルゴリズムを用いた手続き的な
レベル生成手法が採用、研究されていた.[@survey]

コンテンツをあるアルゴリズムにより自動的に生成する手法を一般的にProcedural Content Generation (以下PCG)と呼び,
PCGはゲームレベルだけではなくゲームルール、テクスチャ、サウンドなどの生成も対象としている.

PCGの問題点として自動生成のアルゴリズムに人間の介入による事前知識が必要とされる[@mario-gan].

PCGによる生成が人間の事前知識に依存しているためPCGアルゴリズムの他ゲームへの応用が
難しくなると考えられる.


そこで、近年におけるニューラルネットワークを用いた機械学習による課題解決手法の発展によって
機械学習をゲームレベル作成に応用する研究が行われている.

Volzら[@mario-gan]はGenerative Adversarial Networks（以下GAN）を用いて
ゲームレベルから学習を行い、GANのジェネレータの潜在変数を進化戦略によって設計した.
潜在変数の設計の際にゲームのドメイン固有の知識を用いて目的関数を設計した.
目的関数に対してGANの出力を最適化するように潜在変数を適合させた.

Volzらの研究ではゲームのレベルの数の制約により少数のステージから適切なステージを生成されること
が必要なためGANの学習後に進化戦略を用いた目的関数の設計による修正が必要となる.

機械学習ではデータセットの量が重要[@celeba]な点となるが既存のゲームレベルにおいては
100程度[@vglc gvgai]であり、より多くのゲームレベルを準備できる環境を
整えることが必要である.

この問題を解決するため、今回の研究では株式会社任天堂より発売されているスーパーマリオメーカー2
のゲームレベルを機械学習用のデータセットとして扱えるようにする環境を開発をすることが目的である.

<!---
## 説明１


ニューラルネットワークを用いた機械学習の発展は目覚ましく画像分類や位置推定、音声認識などで人間以上の性能を達成している.

機械学習において重要な課題が解決するタスクのためのデータセットの構築である.
既存のデータセットとしていくつか例を挙げる.
ImageNet[]は1400万枚以上の画像とその画像のアナテーションからなるデータセットである.
ImageNetの画像は2万以上のクラスに分類されている.

SQuAD[]はQ&Aのデータセットでテキストとそのテキストに関する質問文とその答えからなるデータセットである.
SQuADは10万のQ&Aのセットで構成されている.

このように良い性能を得るための学習には多大な量のデータセットが必要となる.

このデータセットが不足している分野がある.それはビデオゲームにおけるレベルである.
ビデオゲームのレベルは一般的に人間の手によって作られておりゲーム内に存在するレベル数は
多くて100程度であるため他のデータセットと比較すると少ない.
データをセット増やす手法として既存研究ではFPSゲームであるDoomのゲームコミュニティで
ユーザによって作成されたステージを用いた.学習のために収集されたデータ数は9000ステージであった.

スーパーマリオメーカーはユーザーがスーパーマリオのレベルを作成し他のユーザと共有できるシステムがある.
2019年6月28日発売されたスーパマリオメーカー2では発売から2週間で共有されたステージ数は200万ステージを超え、既存研究で使用されたステージ数と
比較しても膨大なデータが存在し,現在も増加し続けている.
本研究室ではビデオゲームステージの自動生成の研究を行っている.ゲームの一例として本研究室ではスーパーマリオメーカー2について
のデータインジェクターツールを開発している


近年はビデオゲームによる対戦をスポーツとして捉えるeSportsやスマートフォンを用いたゲームなどゲーム人気は高くなっている.
ゲームを開発するための環境としてUnity[]やUnreal Engine[]といったツールが豊富に揃っておりゲーム開発に対しても敷居が下がってきている.
ゲームの面白さを構成する要素として
近年、ニューラルネットワークを用いた機械学習が盛んに行われている.
機械学習を用いることでクラス分類や画像認識、時系列予測などで高い精度で予測できている.
別のタスクとして画像などから学習を行いデータを自動生成を行う構造を持つGenerative Adversarial Network(GAN)を用いた自動生成による精度は非常に高い結果を出している.
GANを用いた研究では主に画像の自動生成や超解像化、補完などが研究として盛んに行われている.
GANの応用例として3Dモデルの自動生成や音楽の生成、文章の生成などが行われている.
一方でGANを用いたゲームレベル生成の研究は多くない.

## 説明２
本研究の目的はユーザの作成したレベルを元にGANを用いてレベルの学習を行い、新たなステージを自動生成することである.
自動的にレベルを生成することで、人間の手によるレベルの作成作業を減らすことができる.またユーザの趣向に合わせたレベルを
自動的に生成することでプレイヤのゲーム体験の向上が見込まれる.

GANを用いたレベル生成を行う従来研究に[@mario-gan] おいては学習できるステージ数が限られている条件で進化戦略を用いてある
特定の条件に適合させるよう学習を行う手法や ゲームをプレイができるよう学習を行ったエージェントを用いてステージ評価による
レベル学習する手法がある.またこれらの問題点として以下の問題が挙げられる.

1.ドメイン固有ごとに学習プロセスを検討、構築が必要.
2.ゲームプレイすることが可能なエージェントの開発が必要.

1.ではレベルを評価するための事前知識が必要であり、その評価方法によってレベルの方向性が限定され、人間の手で設計する必要があり
汎用性に難がある.ドメインによってはその評価方法が正しいかどうかを定量的に判別するのが難しい場合もある.

2.では事前にプレイ可能な人工知能もしくは人間の手よる評価から学習を行うため人工知能であればプレイ可能なエージェントを学習する必要があり、
人間が評価する場合は人間がプレイできる量には限りがあるため評価できる量に制限ができてしまう.

一般的なゲームにおいてはプレイヤはゲーム開発者が編集したレベルをプレイするが,最近のゲームにおいてプレイヤが自ら
レベルを編集し投稿することで他のプレイヤが遊ぶことができるゲームも存在する.
そのようなゲームの例としてHappy WheelsやSuper Mario Maker などが挙げられる.
ゲーム開発者はレベル編集機能をゲームに搭載することによってレベルコンテンツの作成の手間を減らすことができる.

一方でプレイヤの作成したデータセットを用いることができればそのデータを元に学習することができる.

本論文ではレベル共有することができるSuper Mario Maker2にプレイヤが作成したレベルをデータセットとして整形し
学習することでレベル生成の自動化について述べる.
--->
## 構成
本論文の構成は次の通りである.
第\ref{introduction}章では本研究の背景・目的について，
第\ref{preparation}章では本論文を読む上で必要となる事項について，
第\ref{conventional_method}章では従来環境について，
第\ref{proposed_method}章では提案環境の実装方法について，
第\ref{evaluation}章では提案環境の動作確認と考察について，
第\ref{conclusion}章では本論文のまとめについて述べる.